<html>
  <head>
    &[title];
    <link rel='stylesheet' type='text/css' href='chat/chat.css'/>
    <link rel='stylesheet' type='text/css' href='styles/properties.css'/>
    <script language='JavaScript'>
		window.onerror=myErrorHandler
		function myErrorHandler() {
			return true;
		}

	  var resizedWindow = 0;
	  var timeStampsOn = 1;
      function chatTimerActive() { 
        var timerId = setInterval(
              "document.formScrollLock.chatStartedAt.value = "
            + "  parseInt(document.formScrollLock.chatStartedAt.value) + 1000;"
            + "var dt = new Date(00,0,0,0,0,0);"
            + "dt.setHours(0);"
            + "dt.setMinutes(0);"
            + "dt.setSeconds(0);"
            + "dt.setMilliseconds(parseInt(document.formScrollLock.chatStartedAt.value));"
            + "document.formScrollLock.chatStart.value=''+dt.getHours()+':'+dt.getMinutes()+':'+dt.getSeconds();", 1000);
      }

      function sendMessageOnButton() {
        if (document.postForm.message.value.charAt(0) != "[")
          document.postForm.nameUser.value = "all";
        document.getElementById("message").focus();
        document.getElementById("postForm").submit(); 
        if (document.getElementById("message").value != "") {
          var messageValue = document.getElementById("message").value;		 
          document.getElementById("message").value = "";
          var dt = new Date(); 		  
          var def = dt.getTimezoneOffset()/60;  
	  
		  messageValue = messageValue.split("\n");
    	  messageValue[messageValue.length-1] += '?'+document.getElementById("aliasUser").value;			
		          
		  thread.insertMessages(-def, dt.getTime(), 
              frames['userList'].document.getElementById('c'+document.getElementById("realUserName").value).color,
              document.getElementById("realUserName").value,
              //new Array(messageValue+'?'+document.getElementById("aliasUser").value));
			  messageValue);
        }
        document.getElementById("message").value = ""; 
      }    
    
      function handleKey(e) {
		var kk = navigator.appName == 'Netscape' ? e.which : e.keyCode;
        if (kk == 10 || (e.ctrlKey && kk==13)) {
          if (document.postForm.message.value.charAt(0) != "[")
            document.postForm.nameUser.value = "all";
          document.getElementById("postForm").submit();
          if (document.getElementById("message").value != "") {
            var dt = new Date(); 
            var def = dt.getTimezoneOffset()/60;
			
			messageValue = document.getElementById("message").value.split("\n");
			messageValue[messageValue.length-1] += '?'+document.getElementById("aliasUser").value;
			
			thread.insertMessages(-def,
                dt.getTime(),
                frames['userList'].document.getElementById('c'+document.getElementById("realUserName").value).color,
                document.getElementById("realUserName").value,
                //new Array(document.getElementById("message").value+'?'+document.getElementById("aliasUser").value));
				messageValue);
          }
          document.getElementById("message").value = ""; 
          document.getElementById("message").focus();
        } else if (document.getElementById('message').value.length%10 == 0) {
          document.getElementById("postFormWritingStatus").submit();
          document.getElementById("message").focus();
        }
      }
	  
	  function clockOn(obj) {
	  	if(timeStampsOn==1)
		{
			obj.src='icons/clock.gif';
			timeStampsOn=0;
			var i = 0;
			while(window.frames['chatContents'].document.getElementById('timeNid['+i+']')) 
			{
				frames['chatContents'].document.getElementById('timeNid['+i+']').style.display='none';
				i++;
			}
		}else 
		{
			obj.src='icons/clockOn.png';
			timeStampsOn = 1;
			var i = 0;
			while(window.frames['chatContents'].document.getElementById('timeNid['+i+']'))
			{
				frames['chatContents'].document.getElementById('timeNid['+i+']').style.display='inline';
				i++;
			}
		}
		document.getElementById('message').focus();
	  }
	  
	  function chatHistoryImageOnClick(obj)
	  {
	  		if(resizedWindow==1) 
			{ 
				resizedWindow=0; 
				obj.src='icons/chatHistory.gif'; 
				window.resizeBy(-150,0); 
				document.getElementById('historyiFrame').style.width=0; 
			} else 
			{ 
				resizedWindow=1; 
				obj.src='icons/chatHistoryActive.gif'; 
				window.resizeBy(150,0); 
				document.getElementById('historyiFrame').style.width=150; 
			}
	  }
	  
	  function openInvitationWindow(){
			var urlInv = 'chatRoom?frame=invitationWindow&#38;resourceURL=' + escape('&[openedFrom];') + '&#38;title=' + document.title;
			window.open(urlInv,'Invitation','width=600,height=150,resizable=no,toolbar=no');
	  }

      function hideOpsMenu() {
        document.getElementById("userOpsPanel").style.display = "none";
      }

    </script>   
  </head>
  <body style='cursor : default;' leftmargin='1' topmargin="0" rightmargin='10' bottommargin='5' bgcolor="#E3EAEB"> <!--onLoad='alert("session finished! If you want to be present in this chat room you have to reenter the room.")' //--> 
    <script language="JavaScript">
		window.resizeTo(Math.floor(2*screen.availWidth/3),Math.floor(screen.availHeight*2/3));
		window.moveTo(Math.floor(screen.availWidth/6),Math.floor((screen.availHeight)/6));
	</script>
	<input type='hidden' name='realUserName' id='realUserName' value="&[realUserName];">

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
	<title>Design Model</title>
	<script language="JavaScript">
	function Start()
	{
		var timer = setInterval("var dt = new Date();document.getElementById('timeActive').value=dt.getHours()+':'+dt.getMinutes()+':'+dt.getSeconds();",1000);
	}
      function showOpsMenu(user, userColor, privateTo,userInfoDisplay,sendPrivMessageDisplay,inviteToPrivChatDisplay,inviteToChatRoomDisplay,highlightDisplay) {
        if (document.all)
          document.getElementById("userOpsPanel").style.display = "inline";
        else
          document.getElementById("userOpsPanel").style.display = "table-row";
        
		if((s = frames['chatContents'].document.getElementById(user+'[0]'))&&(s.style.background == '#ffffff' || s.style.background.search('255, 255, 255')>0))
			document.getElementById("highlightDisplay").src="images/highlight.gif";
		  else document.getElementById("highlightDisplay").src="images/fadelight.gif";
			
		document.getElementById("sendPrivateMessagesToUser").value = privateTo;
		document.getElementById("sendPrivateMessagesToUserRealName").value = user;
		
		document.getElementById("userOpsPanelUserName").innerHTML = user;
        document.getElementById("userOpsPanelUserName").style.color = userColor;
		
		document.getElementById("userInfoDisplay").style.display = userInfoDisplay;
		document.getElementById("sendPrivMessageDisplay").style.display = sendPrivMessageDisplay;
		document.getElementById("inviteToPrivChatDisplay").style.display = inviteToPrivChatDisplay;
		document.getElementById("inviteToChatRoomDisplay").style.display = inviteToChatRoomDisplay;
		document.getElementById("highlightDisplay").style.display = highlightDisplay;		
      }
      function hideOpsMenu() {
        document.getElementById("userOpsPanel").style.display = "none";
      }
	  function privateMessageIconClick()
	  {
	  	document.postForm.nameUser.value = document.getElementById('sendPrivateMessagesToUser').value; 
		document.postForm.message.value = '['+document.getElementById('sendPrivateMessagesToUserRealName').value + ']: ' + document.postForm.message.value;
	  }
	  function inviteToChatRoomIconClick()
	  {
	  	frames["userList"].document.getElementById("nameUser").value=document.getElementById('sendPrivateMessagesToUserRealName').value; 
		frames["userList"].document.getElementById("message").value="!-invtUser <font color='#FFCC00'><strong>" + parent.document.getElementById("realUserName").value + "</strong></font> invites you to the chat room <a target=_top href=" + window.location + ">" + document.title+ "</a>";
		frames["userList"].document.inviteUser.submit();
	  }
	  function highlightMessagesIconClick() 
	  {
		parent.document.getElementById("message").focus();
		var doc = frames['chatContents'].document;
		//alert(doc.getElementById(document.getElementById("sendPrivateMessagesToUserRealName").value+'[0]').style.background.search('255, 255, 255'));
		if((s = doc.getElementById(document.getElementById("sendPrivateMessagesToUserRealName").value+'[0]'))&&(s.style.background == '#ffffff' || s.style.background.search('255, 255, 255')>0))
			{color='#ffff00'; document.getElementById("highlightDisplay").src="images/fadelight.gif";}
		else {color='#ffffff'; document.getElementById("highlightDisplay").src="images/highlight.gif";}
		var i = 0;
		while(s = doc.getElementById(document.getElementById("sendPrivateMessagesToUserRealName").value+'['+i+']'))
		{s.style.backgroundColor=color;i++;}
		//8044 2965563   
	  }	  
	  	  	  
	  function showUserInfWindow() 
	  {
		var infWind = window.open("user Information","userInf","width=500,height=100");
		var time = thread.getTimeStr(0,parseInt(userList.document.getElementById('info'+document.getElementById('userOpsPanelUserName').innerHTML).value));
		infWind.document.write("user <font color="+userList.document.getElementById('info'+document.getElementById('userOpsPanelUserName').innerHTML).color+"><b>" + document.getElementById('userOpsPanelUserName').innerHTML + "</b></font> is online since:  " + time);
		infWind.document.write("<br>Chat room the user is present in:  "+userList.document.getElementById('userRoomIn'+document.getElementById('userOpsPanelUserName').innerHTML).value);
	  }

	  function setTitleToUserIcon(user,time,roomName)
	  {	
		var time = parent.thread.getTimeStr(0,parseInt(time));
		var s = "member is present in chat room \""+roomName+"\" since " + time;
		return s;
	  }
	</script>
<link href="styles.css" type="text/css" rel="stylesheet" />
</head>

<body style="cursor:default;">
<script language="JavaScript">
	Start();
</script>

<table width="100%" height="100%" style="border : medium groove #CCCCCC; background : #EDEDED;">
<tr>
  <td>
    <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="4">
      <tr id="userOpsPanel" style="display: none">
        <td colspan="2" height="7%" width="100%">
		<table width="100%" height="100%" style="border:solid #808080 1px; background: #ffffff">
		  <tr><td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                  <tr><td align="left">
                      <table border="0" cellpadding="1" cellspacing="0"><tr>
                        <td><span class="xs">Operations available for user <span id="userOpsPanelUserName" class="xs"></span>:&nbsp;</span></td>
				<td><a style="cursor:pointer;"><img style="display:none" id="userInfoDisplay" src="images/info.gif" border="0" style="cursor:pointer;" alt="user info" title="user info" onclick="showUserInfWindow();"></a></td>
				<td><a style="cursor:pointer;"><img style="display:none" id="sendPrivMessageDisplay" src="images/sendPrivateMessage.gif" border="0" style="cursor:pointer;" height="18" alt="send private messages to user" title="send private messages to user" onclick="privateMessageIconClick()"><input type="hidden" id="sendPrivateMessagesToUser"><input type="hidden" id="sendPrivateMessagesToUserRealName"></a></td>
				<td><a style="cursor:pointer;"><img style="display:none" id="inviteToPrivChatDisplay" src="images/inviteToPrivateChat.gif" border="0" style="cursor:pointer;" height="18" alt="invite user to private chat room" title="invite user to private chat room"></a></td>
				<td><a style="cursor:pointer;"><img style="display:none" id="inviteToChatRoomDisplay" src="images/Invited.gif" border="0" style="cursor:pointer;" alt="invite user to this chat room" title="invite user to this chat room" width="18" height="18" onclick="inviteToChatRoomIconClick()"></a></td>
				<td><a style="cursor:pointer;"><img style="display:none" id="highlightDisplay" src="images/highlight.gif" border="0" style="cursor:pointer;" alt="highlight messages of the user" title="highlight messages of the user" width="16" height="16" align="absmiddle" onclick="highlightMessagesIconClick()"></a></td>
                      </tr></table>
                   </td>
                   <td align="right" valign="center">
                     <img src="icons/hide.gif" alt="Close" title="Close user operations panel" onClick="hideOpsMenu()" style="cursor:pointer">&nbsp;
                   </td>
                   </tr>
                </table>
              </td></tr>
		</table>
        </td>
      </tr>
      <tr>
        <td rowspan="3" height="75%" width="80%"><iframe src="chatRoom?frame=content&room=&[encodedRoom];" id="chatContents" name="chatContents" frameborder="0" style="width:100%;height:100%; background: #FFFFFF; border:solid #808080 1px"></iframe></td>
      </tr>
      <tr>
        <td height="10%" width="20%">
          <div height="100%" width="100%" style="border:solid #808080 1px; background: #ffffff">
              <table border="0" cellpadding="0" cellspacing="0">
                <tr><td>
					<table>
						<tr><td><img src="images/clock.gif" width="18" height="19" align="top" alt="Chat session is open for..." title="Chat session is open for..."></td><td colspan="2"><form style="border:thin none; border-bottom:none; bottom:0px; height:20px; margin-bottom:0px;" name="formScrollLock"><input type=hidden name="chatStartedAt"><input readonly="true" onfocus="document.getElementById('message').focus();" type=text size=10 style="border: none; background: #ffffff;" name="chatStart"></form></td></tr></td></tr></table>
                </td></tr>
	          <tr><td>
                  <table>
                    <tr>
                      <td><img src="icons/clockOn.png" onClick="clockOn(this);" width="16" height="16" align="top" alt="Enable/disable timestamps" title="Enable/disable timestamps"></td>
	                <td><a href="&[openedFrom];" title="link to the page from which the chat was opened" target="_blank"><img border="0" src="icons/status_postponed.gif" width="15" height="15" align="top" alt="Link to the resource this chat is opened for" title="Link to the resource this chat is opened for"></a></td>
	                <td><img src="images/icon_mini_faq.gif" width="16" height="16" align="top" alt="Help" title="Help"></td>
					</tr>
						<script language='JavaScript'>
			    	      chatTimerActive();
						  window.focus();
			        	</script>
                  </table>
                </td></tr>
              </table>
          </div>
        </td>
      </tr>
      <tr>
        <td height="65%" width="20%">
	    <iframe id='userList' name='userList' width="100%" height="100%" frameborder="0" style="border:solid #808080 1px; background: #ffffff" src="chatRoom?frame=userList&room=&[encodedRoom];"></iframe>
	  </td>
      </tr>
</tr>
<tr>
    <td colspan="2" height="25%">
		<table width="100%" height="100%" cellpadding="0" cellspacing="0" border="0">
			<tr>
				<form style="border : thin none; border-bottom : none; bottom : 0px; margin-bottom : 0px;" target='post' id='postForm' name='postForm'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
				<td width="99%" height="100%">
					  <input type="hidden" value="all" name="nameUser" id="nameUser">
		              <input type="hidden" value="my" id="aliasUser" name="aliasUser">
					  <span class=xs><textarea style="width:100%;height:99%; border:solid #808080 1px; margin: 0px" name='message' id='message' onKeyPress="handleKey(event)" onKeyUp="var kk = navigator.appName == 'Netscape' ? event.which : event.keyCode;if (kk == 10 || (event.ctrlKey && kk==13))this.value = '';"></textarea></span>
					  <script language='JavaScript'>
    	    	        document.getElementById('message').value="";
	    	            document.getElementById('message').focus();
              		  </script>
				</td>
				<td width="1%">
					<img onclick='sendMessageOnButton()' border="0" src="images/sendEmpty.gif" alt="send message" title="send message" width="29" height="32" align="right">
				</td>
				</form>
			</tr>
		</table>
	</td>
</tr>
</table>

	
	</td>
</tr>
</table>
    <form target='post' id='postFormWritingStatus' name='postFormWritingStatus'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
      <input type="hidden" value="all"  name="nameUser">
      <input type="hidden" value="my" name="aliasUser">
      <input type=hidden name='message' value='..w..'>
    </form>
    
    <iframe id='thread' name='thread' src='chatRoom?frame=thread&room=&[encodedRoom];' style='width:100px; height: 100px; border: 0'></iframe>
    <div>
      <iframe id='post' name='post' src='chatRoom?frame=post&room=&[encodedRoom];' style='width: 0px; height: 0px; border: 0'></iframe>
    </div>  



</body>
</html>

