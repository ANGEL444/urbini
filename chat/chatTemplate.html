<html>
  <head>
    &[title];
    <link rel='stylesheet' type='text/css' href='chat/chat.css'/>
    <!--link rel='stylesheet' type='text/css' href='styles/properties.css'/ //-->
	  <link href="styles.css" type="text/css" rel="stylesheet" /> 
    <script src="chat/chatJS.js" language="JavaScript" type="text/javascript"></script>

    <script language='JavaScript'>
		var postLoaded = 0;     // ==1 when the post iframe is loaded
		var contentLoaded = 0;  // ==1 when the content iframe is loaded
		var usersLoaded = 0;    // ==1 when the users iframe is loaded
		
		var encodedRoom = '&[encodedRoom];';
		var sendDivTimeOut;
		var sendShortcut; // Shortcut of the message sending
		var chatSoundPresent = 1; // Sound enabled in chat
		var soundViaApplet = 0;
		var isWindowInFocus = "blured";
		var titleScrollHandler;
		var titleTimeOut;
		var privateR = '&[privateR];';
//---------START------------------------These variables are used in chat reconnect chat task ------------------------------------
		var threadIframeContent = 0; // this variable contains the length of the thread iframe content. 
		var connectTimeOut = ""; // check Connection task - reconnect chat
		                         // this variable is used in checkOnlineStatus() to handle setTimeout("checkOnlineStatus()",5000);
//---------FINISH------------------------These variables are used in chat reconnect chat task ------------------------------------								 

		addEvent(window, 'focus', function() {isWindowInFocus="focused";clearInterval(titleTimeOut);}); 
		addEvent(window, 'blur', function() {isWindowInFocus="blured";}); 

		window.onerror=myErrorHandler;
    </script>   
  </head>
  <body onload="initFrames(); initEventHandling();checkOnlineStatus();" onclick="isWindowInFocus='focused';clearInterval(titleTimeOut);" onfocus="isWindowInFocus='focused';clearInterval(titleTimeOut);" onblur="isWindowInFocus='blured';" style='cursor : pointer;' leftmargin='1' topmargin="0" rightmargin='10' bottommargin='5' bgcolor="#EDEDED"> <!--onLoad='alert("session finished! If you want to be present in this chat room you have to reenter the room.")' //--> 
    <script language="JavaScript">
		  //window.resizeTo(Math.floor(screen.availWidth*2/3),Math.floor(screen.availHeight*2/3));
		  //window.moveTo(Math.floor(screen.availWidth/6),Math.floor((screen.availHeight)/6));
	  </script>
	  <input type='hidden' name='realUserName' id='realUserName' value="&[realUserName];">
	  <input type='hidden' name='aliasUserUri' id='aliasUserUri' value="&[aliasUserUri];">

    <table onmouseover="" width="100%" height="100%" style="border : medium groove #CCCCCC; background : #EDEDED;">
      <tr>
        <td>
          <table cellspacing="1" cellpadding="0" border="0" width="100%" height="100%">
          <!-----------------------------------------------START---------OPERATIONAL PANEL DEFINITION ------------------------------------------------------------------>
            <tr id="userOpsPanel" style="display: none">
              <td colspan="2" height="30" width="100%">
		            <table width="100%" height="100%" id="userOpsPanelTable" style="height:30; background : url(images/chat_toolbar_bg.gif);">
		              <tr>
		                <td>
                      <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr>
				                  <td align="left">
                            <table border="0" cellpadding="1" cellspacing="0">
                              <tr>
                                <td><span class="xs">Operations available for <span id="userOpsPanelUserName" class="xs"></span>:&nbsp;</span></td>
				                        <td><a style="cursor:pointer;" href="" target="_blank" onclick="this.href = document.getElementById('infoCP'+document.getElementById('sendPrivateMessagesToUser').value).value"><img style="display:none" id="userInfoDisplay" src="images/info.gif" border="0" style="cursor:pointer;" alt="user info" title="user info" onclick="/*showUserInfWindow();*/"></a></td>
  				                      <td><a style="cursor:pointer;"><img style="display:none" id="sendPrivMessageDisplay" src="images/sendPrivateMessage.gif" border="0" style="cursor:pointer;" height="18" alt="send private messages to user" title="send private messages to user" onclick="privateMessageIconClick()"><input type="hidden" id="sendPrivateMessagesToUser"><input type="hidden" id="sendPrivateMessagesToUserRealName"></a></td>
				                        <td><a style="cursor:pointer;"><img style="display:none" id="inviteToPrivChatDisplay" src="images/inviteToPrivateChat.gif" border="0" style="cursor:pointer;" height="18" alt="invite user to private chat room" title="invite user to private chat room" onclick="inviteToPrivateChatRoomIconClick()"></a></td>
				                        <td><a style="cursor:pointer;"><img style="display:none" id="inviteToChatRoomDisplay" src="images/Invited.gif" border="0" style="cursor:pointer;" alt="invite user to this chat room" title="invite user to this chat room" width="18" height="18" onclick="inviteToChatRoomIconClick()"></a></td>
				                        <td><a style="cursor:pointer;"><img style="display:none" id="highlightDisplay" src="images/highlight.gif" border="0" style="cursor:pointer;" alt="highlight messages of the user" title="highlight messages of the user" width="16" height="16" align="absmiddle" onclick="highlightMessagesIconClick()"></a></td>
				                        <td><a style="cursor:pointer;" target="_blank" id="AlinkToResource"><img style="display:none;cursor:pointer" id="linkToResource" src="icons/openFor.gif" border="0" width="16" height="18" alt="Link to the resource the chat is opened for" title="Link to the resource the chat is opened for" onclick="document.getElementById('AlinkToResource').href=document.getElementById('linkToResource'+document.getElementById('sendPrivateMessagesToUserRealName').value).value"></a></td>
                                <td><a style="cursor:pointer;" id="AjoinChatRoom"><img style="display:none;cursor:pointer" id="joinChatRoom" src="icons/webchat.gif" border="0" width="15" height="15" alt="Join the room where the user is present." title="Join the room where the user is present." onclick="document.getElementById('AjoinChatRoom').href = 'chatRoom?title='+document.getElementById('userRoomIn'+document.getElementById('userOpsPanelUserName').innerHTML).value + '&#38;referer=' + escape(document.getElementById('linkToResource'+document.getElementById('sendPrivateMessagesToUserRealName').value).value)"></a></td>
				                      </tr>
					                  </table>
                          </td>
                          <td align="right" valign="center">
                            <img src="icons/hide.gif" alt="Close" title="Close user operations panel" onClick="hideOpsMenu();" style="cursor:pointer">&nbsp;
                          </td>
                        </tr>
                      </table>
                    </td>
		              </tr>
		            </table>
              </td>
            </tr>
            <!-----------------------------------------------FINISH---------OPERATIONAL PANEL DEFINITION ------------------------------------------------------------------>
            <tr>
            <!-----------------------------------------------START---------CHAT CONTENTS PANEL DEFINITION ------------------------------------------------------------------>
              <td valign="top" rowspan="2" height="20" width="80%" id="tdChatContents" bgcolor="#EDEDED"  cellspacing="0" cellpadding="0"> <!-- chat contents bgcolor="#EDEDED" -->
		            <div id='chatContents' name='chatContents'>
                  <div id="body1"></div>
                </div>
		          </td>
          <!-----------------------------------------------FINISH---------CHAT CONTENTS PANEL DEFINITION ------------------------------------------------------------------>
          <!-----------------------------------------------START---------TIME PANEL DEFINITION ------------------------------------------------------------------>
              <td height="5%" width="20%" valign="top" bgcolor="#EDEDED" style="height:1">  <!-- bgcolor="#EDEDED" //--> <!-- TIME panel //-->
                <div height="100%" width="100%" id="timePanel">
                <table border="0" cellpadding="0" cellspacing="0">
                  <tr>
		          		  <td>
			          		  <table>
			          			  <tr>
			          			    <td>
						                <img src="images/clock.gif" width="18" height="19" align="top" alt="Chat session is open for..." title="Chat session is open for...">
          						    </td>
					          	    <td colspan="2">
          							    <form style="border:thin none; border-bottom:none; bottom:0px; height:20px; margin-bottom:0px;" name="formScrollLock">
					          		      <input type=hidden name="chatStartedAt"><input readonly="true" onfocus="document.postForm.message.focus();" type=text size=10 style="border: none; background: #ffffff;" name="chatStart">
          							    </form>
			          			    </td>
		          				  </tr>
		          			  </table>
                    </td>
		          		</tr>
	                <tr>
		          		  <td>
                      <table>
                        <tr>
                          <td>
			          			      <img src="icons/clockOn.png" style="cursor:pointer" onClick="clockOn(this);" width="16" height="16" align="top" alt="Enable/disable timestamps" title="Enable/disable timestamps">
                          </td>
	                        <td>
		          				      <a href="&[openedFrom];" title="link to the page from which the chat was opened" target="_blank">
		          					      <img border="0" src="icons/openFor.gif" width="16" height="19" align="top" alt="Link to the resource this chat is opened for" title="Link to the resource this chat is opened for">
	          					      </a>
	          					    </td>
	                        <td>
		          				      <img src="images/icon_mini_faq.gif" width="16" height="16" align="top" alt="Help" title="Help">
                          </td>
		          				    <td>
		          				      <img src="icons/hide.gif" width="16" height="16" align="top" title="exit room" onclick="closeChatWindow()" style="cursor:pointer">
                          </td>
                        </tr>
		          				  <script language='JavaScript'>
                          chatTimerActive();
                          window.focus();
                        </script>
                      </table>
                    </td>
	          			</tr>
                </table>
                </div>
              </td>
<!-----------------------------------------------FINISH---------TIME PANEL DEFINITION ------------------------------------------------------------------>
            </tr>
            <tr>
<!-----------------------------------------------START---------USERS LIST PANEL DEFINITION ------------------------------------------------------------------>
              <td valign="top" height="95%" id="tdUserList" cellspacing="0" cellpadding="0"> <!-- USERS LIST//-->
                <div id='userList' name='userList'>
	          	    <form name='inviteUser' method='post' target="post" action='chatRoom?frame=post&room=invitationChatRoom'>
                     <input type='hidden' value='' name='message' id='message'>
                     <input type='hidden' name='nameUser' id='nameUser' value=''>
                     <font color='#33A3D2'>
                       <span class=xs><b>Current Room:</b></span>
                     </font>
                     <br>
                     <div id=bodyMembersKeeper bgcolor='#E3EAEB'>
                       <div id=divUsersContainer>
                       </div>
                     </div>
              		</form>
	            	</div>	
	            </td>
<!-----------------------------------------------FINISH---------USERS LIST PANEL DEFINITION ------------------------------------------------------------------>
            </tr>
            <tr>
<!-----------------------------------------------START---------RTE DEFINITION ------------------------------------------------------------------>
              <td colspan="2"> <!-- RTE //-->
                <form style="border : thin none; border-bottom : none; bottom : 0px; margin-bottom : 0px;" target='post' id='postForm' name='postForm'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
	            	  <input type="hidden" value="all" name="nameUser" id="nameUser">
	            	  <input type="hidden" value="my" id="aliasUser" name="aliasUser">
                  <!-- RTE's panel will be loaded to this div//-->
                  <div id="messageRTEdv" style="height:0" align="center"></div> 
                  <!-- RTE's iframe together with the send button image//-->
                  <table width="100%">
                    <tr>
                      <td width="100%">
                        <iframe style='background-color:#ffffff;border : 1px outset;' id='messageRTE' name='messageRTE' width="100%" height="50">
                        </iframe>
                      </td>
	                    <td>
                        <img onclick="sendMessageOnButton()" border="0" id="sendMesButton" src="icons/Chat-large.gif" alt="send message" title="send message" width="29" height="32">
                      </td>
                    </tr>
                  </table>
                  <input type="hidden" id="hdnmessageRTE" name="messageRTE" value="">
                  <script language="JavaScript" type="text/javascript" src="chat/richtext.js"></script>
                  <script language="JavaScript" type="text/javascript">
                    //Usage: initRTE(imagesPath, includesPath, cssFile)
                    initRTE("images/wysiwyg/", "chat/", "");
                    // add RTE to chat 
                    addRTE();
                  </script>
                  <input type="Hidden" name='message' id='message'> <!--the cleaned message will be loaded to this hidden object named 'message'//-->
			            <script language='JavaScript'>
                	  document.postForm.message.value="";
                  </script>
	              </form>
              </td>
<!-----------------------------------------------FINISH---------RTE DEFINITION ------------------------------------------------------------------>
            </tr>
         </table>  

        </td>
      </tr>
    </table>
    <bgsound id="sound">
    <embed src='chat/DingDong.wav' height="0" autostart=false hidden=true id="sound1" enablejavascript="true" height="0"> 	
    <form target='post' id='postFormWritingStatus' name='postFormWritingStatus'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
      <input type="hidden" value="all"  name="nameUser">
      <input type="hidden" value="my" name="aliasUser">
      <input type=hidden name='message' value='..w..'>
    </form>
    <iframe id='thread' name='thread' src='about:blank' style='width:0px; height: 0px; border: 0'></iframe>
    <div>
      <iframe id='post' name='post' src='about:blank' style='width: 0px; height: 0px; border: 0'></iframe>
    </div>  
    <div id="soundAppletDiv" style="height:0;width:0"></div>
    <script language="JavaScript">
      window.onresize = onResizeEventHandler;
	    function initFrames() {
        onResizeEventHandler();
  		  var postDiv = document.getElementById('post');
        postDiv.src='chatRoom?frame=post&room=&[encodedRoom];'
      }
    </script>
</body>
</html>