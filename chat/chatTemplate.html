<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    &[title];
    <link rel='stylesheet' type='text/css' href='chat/chat.css'/>
    <!--link rel='stylesheet' type='text/css' href='styles/properties.css'/ //-->
	  <!--link href="styles.css" type="text/css" rel="stylesheet" /-->
    <script src="chat/chatJS.js" language="JavaScript" type="text/javascript"></script>
	
	<script src="richtext.js" language="JavaScript" type="text/javascript"></script>
    <script src="toolbar.js" language="JavaScript" type="text/javascript"></script>
    <script src="menu.js" language="JavaScript" type="text/javascript"></script>

    <script language='JavaScript' type="text/javascript">
		var postLoaded = 0;     // ==1 when the post iframe is loaded
		var contentLoaded = 0;  // ==1 when the content iframe is loaded
		var usersLoaded = 0;    // ==1 when the users iframe is loaded

		var encodedRoom = '&[encodedRoom];';
		var sendDivTimeOut;
		var sendShortcut; // Shortcut of the message sending
		var chatSoundPresent = 1; // Sound enabled in chat
		var soundViaApplet = 0;
		var isWindowInFocus = "blured";
		var privateR = '&[privateR];';
//---------START------------------------These variables are used in chat reconnect chat task ------------------------------------
		var threadIframeContent = 0; // this variable contains the length of the thread iframe content.
		var connectTimeOut = ""; // check Connection task - reconnect chat
		                         // this variable is used in checkOnlineStatus() to handle setTimeout("checkOnlineStatus()",5000);
//---------FINISH------------------------These variables are used in chat reconnect chat task ------------------------------------

		addEvent(window, 'focus', function() {isWindowInFocus="focused";});
		addEvent(window, 'blur', function() {isWindowInFocus="blured";});
		//window.onerror=myErrorHandler;
    </script>
  </head>
  <body onload="RteEngine.register('messageRTE', 'rte_data', RteEngine.chatRTE); initFrames(); checkOnlineStatus(); isChatWithTheAgent('&[isChatWithTheAgent];');" onclick="isWindowInFocus='focused';" onfocus="isWindowInFocus='focused';" onblur="isWindowInFocus='blured';" leftmargin='1' topmargin="0" rightmargin='10' bottommargin='5'>
	  <input type='hidden' name='realUserName' id='realUserName' value="&[realUserName];">
	  <input type='hidden' name='aliasUserUri' id='aliasUserUri' value="&[aliasUserUri];">

    <table onmouseover="" width="100%" height="100%" style="border : medium groove #CCCCCC; background : buttonface;">
      <tr>
        <td>
          <table cellspacing="1" cellpadding="0" border="0" width="100%" height="100%">
          <!-----------------------------------------------START---------OPERATIONAL PANEL DEFINITION ------------------------------------------------------------------>
            <tr id="userOpsPanel" style="display: none">
              <td colspan="2" height="30" width="100%">
		            <table width="100%" height="100%" id="userOpsPanelTable" style="height:30; background : url(images/chat_toolbar_bg.gif);">
		              <tr>
		                <td>
                      <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tr>
				                  <td align="left">
                            <table border="0" cellpadding="1" cellspacing="0">
                              <tr>
                                <td><span class="xs">Operations available for <span id="userOpsPanelUserName" class="xs"></span>:&nbsp;</span></td>
				                        <td>
                                  <a style="cursor:pointer;" href="#" target="_blank" onclick="this.href = document.getElementById('infoCP'+document.getElementById('sendPrivateMessagesToUser').value).value">
                                    <img style="display:none; cursor:pointer" id="userInfoDisplay" src="images/info.gif" border="0" alt="user info" title="user info" onclick="/*showUserInfWindow();*/">
                                  </a>
                                </td>
  				                      <td>
                                  <a style="cursor:pointer;" href="#">
                                    <img style="cursor:pointer;display:none" id="sendPrivMessageDisplay" src="images/sendPrivateMessage.gif" border="0" height="18" alt="send private messages to user" title="send private messages to user" onclick="privateMessageIconClick()">
                                    <input type="hidden" id="sendPrivateMessagesToUser">
                                    <input type="hidden" id="sendPrivateMessagesToUserRealName">
                                  </a>
                                </td>
				                        <td>
                                  <a style="cursor:pointer;" href="#">
                                    <img style="cursor:pointer;display:none" id="inviteToPrivChatDisplay" src="images/inviteToPrivateChat.gif" border="0" height="18" alt="invite user to private chat room" title="invite user to private chat room" onclick="inviteToPrivateChatRoomIconClick()">
                                  </a>
                                </td>
				                        <td>
                                  <a style="cursor:pointer;" href="#">
                                    <img style="cursor:pointer;display:none" id="inviteToChatRoomDisplay" src="images/Invited.gif" border="0" alt="invite user to this chat room" title="invite user to this chat room" width="18" height="18" onclick="inviteToChatRoomIconClick()">
                                  </a>
                                </td>
				                        <td>
                                  <a style="cursor:pointer;" href="#">
                                    <img style="cursor:pointer;display:none" id="highlightDisplay" src="images/highlight.gif" border="0" alt="highlight messages of the user" title="highlight messages of the user" width="16" height="16" align="absmiddle" onclick="highlightMessagesIconClick()">
                                  </a>
                                </td>
				                        <td>
                                  <a style="cursor:pointer;" target="_blank" id="AlinkToResource">
                                    <img style="display:none;cursor:pointer" id="linkToResource" src="icons/openFor.gif" border="0" width="16" height="18" alt="Link to the resource the chat is opened for" title="Link to the resource the chat is opened for" onclick="document.getElementById('AlinkToResource').href=document.getElementById('linkToResource'+document.getElementById('sendPrivateMessagesToUserRealName').value).value">
                                  </a>
                                </td>
                                <td>
                                  <a style="cursor:pointer;" id="AjoinChatRoom">
                                    <img style="display:none;cursor:pointer" id="joinChatRoom" src="icons/webchat.gif" border="0" width="15" height="15" alt="Join the room where the user is present." title="Join the room where the user is present." onclick="document.getElementById('AjoinChatRoom').href = 'chatRoom?title='+document.getElementById('userRoomIn'+document.getElementById('userOpsPanelUserName').innerHTML).value + '&#38;referer=' + escape(document.getElementById('linkToResource'+document.getElementById('sendPrivateMessagesToUserRealName').value).value)">
                                  </a>
                                </td>
				                      </tr>
					                  </table>
                          </td>
                          <td align="right" valign="center">
                            <img src="icons/hide.gif" alt="Close" title="Close user operations panel" onClick="hideOpsMenu();" style="cursor:pointer">&nbsp;
                          </td>
                        </tr>
                      </table>
                    </td>
		              </tr>
		            </table>
              </td>
            </tr>
            <!-----------------------------------------------FINISH---------OPERATIONAL PANEL DEFINITION ------------------------------------------------------------------>
            <tr>
            <!-----------------------------------------------START---------CHAT CONTENTS PANEL DEFINITION ------------------------------------------------------------------>
              <td valign="top" rowspan="2" height="20" width="80%" id="tdChatContents" style="background:buttonface;"  cellspacing="0" cellpadding="0"> <!-- chat contents bgcolor="#EDEDED" -->
		            <div id='chatContents' name='chatContents'>
                  <div id="body1"></div>
                </div>
		          </td>
          <!-----------------------------------------------FINISH---------CHAT CONTENTS PANEL DEFINITION ------------------------------------------------------------------>
          <!-----------------------------------------------START---------TIME PANEL DEFINITION ------------------------------------------------------------------>
              <td height="5%" width="20%" valign="top" style="background:buttonface;">  <!-- bgcolor="#EDEDED" //--> <!-- TIME panel //-->
                <div height="100%" width="100%" id="timePanel">
                <table border="0" cellpadding="0" cellspacing="0">
                  <tr>
		          		  <td>
			          		  <table>
			          			  <tr>
			          			    <td>
						                <img src="images/clock.gif" width="18" height="19" align="top" alt="Chat session is open for..." title="Chat session is open for...">
          						    </td>
					          	    <td colspan="2">
          							    <form style="border:thin none; border-bottom:none; bottom:0px; height:20px; margin-bottom:0px;" name="formScrollLock">
					          		      <input type=hidden name="chatStartedAt"><input readonly="true" onfocus="try {document.postForm.message.focus()} catch(e) {};" type=text size=10 style="border: none; background: #ffffff;" name="chatStart">
          							    </form>
			          			    </td>
		          				  </tr>
		          			  </table>
                    </td>
		          		</tr>
	                <tr>
		          		  <td>
                      <table>
                        <tr>
                          <td>
			          			      <img src="icons/clockOn.png" style="cursor:pointer" onClick="clockOn(this);" width="16" height="16" align="top" alt="Enable/disable timestamps" title="Enable/disable timestamps">
                          </td>
	                        <td>
		          				      <a href="&[openedFrom];" title="link to the page from which the chat was opened" target="_blank">
		          					      <img border="0" src="icons/openFor.gif" width="16" height="19" align="top" alt="Link to the resource this chat is opened for" title="Link to the resource this chat is opened for">
	          					      </a>
	          					    </td>
	                        <td>
		          				      <img onclick="askForHelp()" src="images/icon_mini_faq.gif" style="cursor:pointer" width="16" height="16" align="top" alt="Help" title="Ask for help. Somebody from the support group will help you.">
                          </td>
		          				    <td>
		          				      <img src="icons/hide.gif" width="16" height="16" align="top" title="exit room" onclick="closeChatWindow()" style="cursor:pointer">
                          </td>
                          <td>
                            <img src="/images/icon_mini_profile_online.gif" width="16" height="16" align="top" title="Status" onclick="showAwailableOnlineModes(this)" onmouseout="onlineStatusIconMouseOut()" style="cursor:pointer">
                          </td>
                        </tr>
		          				  <script language='JavaScript' type="text/javascript">
                          chatTimerActive();
                          window.focus();
                        </script>
                      </table>
                    </td>
	          			</tr>
                </table>
                </div>
              </td>
<!-----------------------------------------------FINISH---------TIME PANEL DEFINITION ------------------------------------------------------------------>
            </tr>
            <tr>
<!-----------------------------------------------START---------USERS LIST PANEL DEFINITION ------------------------------------------------------------------>
              <td valign="top" height="95%" id="tdUserList" cellspacing="0" cellpadding="0"> <!-- USERS LIST//-->
                <div id='userList' name='userList'>
	          	    <form name='inviteUser' method='post' target="post" action='chatRoom?frame=post&room=invitationChatRoom'>
                     <input type='hidden' value='' name='message' id='message'>
                     <input type='hidden' name='nameUser' id='nameUser' value=''>
                     <font color='#33A3D2'>
                       <span class=xs><b>Contacts</b></span>
                     </font>
                     <br>
                     <div id=bodyMembersKeeper bgcolor='#E3EAEB'>
                       <div id=divUsersContainer>
                       </div>
                     </div>
              		</form>
	            	</div>
	            </td>
<!-----------------------------------------------FINISH---------USERS LIST PANEL DEFINITION ------------------------------------------------------------------>
            </tr>
            <tr>
<!-----------------------------------------------START---------RTE DEFINITION ------------------------------------------------------------------>
              <td colspan="2"> <!-- RTE //-->
                <form style="border : thin none; border-bottom : none; bottom : 0px; margin-bottom : 0px;" target='post' id='postForm' name='postForm'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
	            	  <input type="hidden" value="all" name="nameUser" id="nameUser">
	            	  <input type="hidden" value="my" id="aliasUser" name="aliasUser">
                  <!-- RTE's panel will be loaded to this div//-->
                  <div id="messageRTEdv" style="height:0" align="center"></div>
                  <!-- RTE's iframe together with the send button image//-->
                  <table width="100%">
                    <tr>
                      <td width="100%">
                      <div width="100%" style="position:relative;">
                        <iframe id='messageRTE' name='messageRTE' style='background-color:#ffffff; border:1px outset;'
                          width="100%" height="200" class="RTE" fldId="rte_data" type="chatRTE">
                        </iframe>
                        <!--
                        id="hdnmessageRTE"
                        -->
                        <input id="rte_data" type="hidden" name="messageRTE" value="">

                      </div>
                      </td>
	                    <td>
                        <img onclick="sendMessageOnButton()" border="0" id="sendMesButton" src="icons/Chat-large.gif" alt="send message" title="send message" style='cursor : pointer;' width="29" height="32">
                      </td>
                    </tr>
                  </table>
                  <script language="JavaScript" type="text/javascript" src="chat/richtext.js"></script>
                  <input type="Hidden" name='message' id='message'> <!--the cleaned message will be loaded to this hidden object named 'message'//-->
			            <script language='JavaScript' type="text/javascript">
                	  document.postForm.message.value="";
                  </script>
	              </form>
              </td>
<!-----------------------------------------------FINISH---------RTE DEFINITION ------------------------------------------------------------------>
            </tr>
         </table>

        </td>
      </tr>
    </table>
    <bgsound id="sound">
    <embed src='chat/DingDong.wav' height="0" autostart=false hidden=true id="sound1" enablejavascript="true" height="0">
    <form target='post' id='postFormWritingStatus' name='postFormWritingStatus'  method='post' action='chatRoom?frame=post&room=&[encodedRoom];'>
      <input type="hidden" value="all"  name="nameUser">
      <input type="hidden" value="my" name="aliasUser">
      <input type=hidden name='message' value='..w..'>
    </form>
    <iframe id='thread' name='thread' src='about:blank' style='width:0px; height: 0px; border: 0'></iframe>
    <div>
      <iframe id='post' name='post' src='about:blank' style='width: 0px; height: 0px; border: 0'></iframe>
    </div>
    <div id="soundAppletDiv" style="height:0;width:0"></div>
    <script language="JavaScript" type="text/javascript">
      window.onresize = onResizeEventHandler;
	    function initFrames() {
        onResizeEventHandler();
  		  var postDiv = document.getElementById('post');
        postDiv.src='chatRoom?frame=post&room=&[encodedRoom];'
      }
    </script>

    <!-- online status table //-->
    <table cellpadding="1" border="1" rules="groups" cellspacing="0" onmouseover="clearTimeoutForStatusMenu()" onmouseout="statusMenuMouseOut();" style="cursor : text;display:none;position:absolute;background-color:#ffffff;border : 1px solid Silver;" id="dvOnlineStatus">
      <tr style="cursor:pointer;" onclick="changeOnlineStatus('online'); onlineStatusIconMouseOut();" onmouseover="this.style.backgroundColor='#eee'" onmouseout="this.style.backgroundColor='#fff'">
	      <td bgcolor="#D4D4D4"><img src="/images/icon_mini_profile_online.gif" width="16" height="16" align="top"></td>
      	<td>online</td>
      </tr>
      <tr style="cursor:pointer;" onclick="changeOnlineStatus('away');onlineStatusIconMouseOut();" onmouseover="this.style.backgroundColor='#eee'" onmouseout="this.style.backgroundColor='#fff'">
      	<td bgcolor="#D4D4D4"><img src="/images/icon_mini_profile_away.gif" width="16" height="16" align="top"></td>
      	<td>away</td>
      </tr>
      <tr style="cursor:pointer;" onclick="changeOnlineStatus('dnd');onlineStatusIconMouseOut();" onmouseover="this.style.backgroundColor='#eee'" onmouseout="this.style.backgroundColor='#fff'">
      	<td bgcolor="#D4D4D4"><img src="/images/icon_mini_profile_dnd.gif" width="16" height="16" align="top"></td>
      	<td>dnd</td>
      </tr>
      <tr style="cursor:pointer" onclick="changeOnlineStatus('na');onlineStatusIconMouseOut();" onmouseover="this.style.backgroundColor='#eee'" onmouseout="this.style.backgroundColor='#fff'">
      	<td bgcolor="#D4D4D4"><img src="/images/icon_mini_profile_na.gif" width="16" height="16" align="top"></td>
      	<td>na</td>
      </tr>
    </table>
</body>
</html>